# Namespace
namespace: monitoring

# ---------------------------------------
# Prometheus
# ---------------------------------------
prometheus:
  prometheusSpec:
    retention: "30d"            # conserve 30 jours de m√©triques
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 1
        memory: 2Gi
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: default
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi

# ---------------------------------------
# Grafana
# ---------------------------------------
grafana:
  adminUser: "admin"
  adminPasswordExistingSecret: "grafana-admin"
  service:
    type: ClusterIP
  grafana.ini:
    server:
      root_url: "%(protocol)s://%(domain)s:%(http_port)s/grafana/"
      serve_from_sub_path: true
  extraVolumeMounts:
    - name: grafana-secrets
      mountPath: /mnt/secrets-store
      readOnly: true
  extraVolumes:
    - name: grafana-secrets
      csi:
        driver: secrets-store.csi.k8s.io
        readOnly: true
        volumeAttributes:
          secretProviderClass: azure-kv-grafana
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - grafana.mydomain.com
    tls:
      - secretName: grafana-tls
        hosts:
          - grafana.mydomain.com
    annotations:
      kubernetes.io/ingress.class: nginx
      cert-manager.io/cluster-issuer: letsencrypt-prod

# ---------------------------------------
# Alertmanager
# ---------------------------------------
alertmanager:
  alertmanagerSpec:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 200m
        memory: 512Mi

# Placeholder pour Slack/Email
# alertmanager.config:
#   global:
#     resolve_timeout: 5m
#   route:
#     receiver: 'slack-notifications'
#   receivers:
#   - name: 'slack-notifications'
#     slack_configs:
#     - api_url: 'https://hooks.slack.com/services/...'
#       channel: '#alerts'

# ---------------------------------------
# Node Exporter & Kube State Metrics
# ---------------------------------------
kube-state-metrics:
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 256Mi

nodeExporter:
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 256Mi
